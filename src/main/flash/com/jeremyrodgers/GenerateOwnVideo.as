package com.jeremyrodgers {		/**	* ...	* @author Jeremy Rodgers	*/			import com.codedrunks.components.flash.ShareOwnVideoWindow;	import com.codedrunks.components.flash.ShareVideo;	import com.dVyper.utils.Alert;		import fl.containers.UILoader;	import fl.controls.*;	import fl.controls.listClasses.*;	import fl.controls.listClasses.TileListData;	import fl.core.*;	import fl.data.*;	import fl.events.*;	import fl.transitions.Tween;	import fl.transitions.TweenEvent;	import fl.transitions.easing.None;	import fl.transitions.easing.Strong;		import flash.display.*;	import flash.display.Loader;	import flash.events.*;	import flash.events.MouseEvent;	import flash.geom.*;	import flash.media.Sound;	import flash.media.SoundChannel;	import flash.net.*;	import flash.system.Security;	import flash.text.*;	import flash.utils.*;		import ikriti.natgeo.vo.CaptionVO;	import ikriti.natgeo.vo.MakeYourOwnVideoVO;		import net.slideshowpro.slideshowpro.SlideShowPro;	import net.slideshowpro.thumbgrid.TGThumbEvent;			public class GenerateOwnVideo extends MovieClip	{		private var state:XML;		private var ldr:URLLoader;		private var urq:URLRequest;		private var dp_pool:DataProvider;		private var dp_sel1:DataProvider;		private var nc:NetConnection;		private var ns:NetStream;		private var net_client:Object;		private var idx:Number;				[Bindable]		private var mediaDisplayedNum:int = 1;		private var totalDuration:int;		private var durationPerMedia:int = 5000;		private var dividerMoveTimer:Timer;		private var soundClip:Sound;		private var mousePressed:Boolean;		private var mouseReleased:Boolean;		private var withSound:Boolean = false;		private var imgArray:Array = new Array();		private var urlLoaderImage:URLLoader;		private var ldrLoader:Loader = new Loader();		private var imageLen:Number = 0;		private var indexLoading:Number = 0;		private var arraySize:Number = 0;		private var loaderForGallery:UILoader;		private var previousLoader:UILoader = new UILoader();		private var index:Number = 0;		private var previewTimer:Timer;		private var songUrl:String = "";		private var sndChannel:SoundChannel; 		private var timing:Number = 0;				private var my_speed:Number;		private var my_total:Number;		private var my_images:Array;				private var my_loaders_array:Array=[];		private var my_labels_array:Array=[];		private var my_success_counter:Number=0;		private var my_playback_counter:Number=0;				//private var my_slideshow:my_slideshow = new my_slideshow();		private var my_image_slides:Sprite = new Sprite();		private var my_label_slides:Sprite = new Sprite();		private var my_preloader:TextField;				private var my_timer:Timer;		private var my_prev_tween:Tween;		private var my_tweens_array:Array=[];		private var noneTextFormat:TextFormat = new TextFormat();		private var trackTextFormat:TextFormat = new TextFormat();				private var resultImagesArr:Array = new Array();				private var app:MovieClip;		private var view:MissionArmy;		private var makeYourOwnVideoVO:MakeYourOwnVideoVO;				private var my_xml_loader:URLLoader = new URLLoader();		[Bindable]		private var captionArr:Array = new Array();		[Bindable]		private var captionItemIndex:int;		[Bindable]		private var tnListIndex:int;		private var videoId:int;		private var prevBtnClicked:Boolean;				Security.allowDomain("*");		Security.allowInsecureDomain("*");				/* STAGE VARS				ddt_pool			:dd_tile_list;		ddt_sel				:dd_tile_list;		txt_message			:TextField		--- */		function GenerateOwnVideo(viewComponent:MissionArmy)		{			view = viewComponent as MissionArmy;						Alert.init(this.stage);						Security.allowDomain("*");			Security.allowInsecureDomain("*");		}				public function initialize(makeVideoMc:MovieClip):void		{			app = makeVideoMc as MovieClip;			app.transRect.x = 0;			app.myovInfoMc.x = 0;			app.closeBtn.x = 427.35;			app.closeBtn.addEventListener(MouseEvent.CLICK,handleCloseBtnClicked);			SlideShowPro(app.thumbSlideshow).setData("http://apptikka.com/natgeoindia/fb/missionarmy/canvas/assets/slideshowClips.xml","Default");			//app.thumbSlideshow.setData("assets/slideshowClips.xml","Default");			idx = 0;			init_ddt_sel1();			/*app.thumbSlideshow.xmlFilePath = "assets/slideshowClips.xml";			app.thumbSlideshow.xmlFileType = "Default";*/			app.tmbgrd.addEventListener(TGThumbEvent.CLICK_THUMB,onThumbClick);			init_ui();			initApp();		}				public function initApp():void		{			trackTextFormat.color = 0x999999;			noneTextFormat.color = 0xFFFFFF;						app.trackOne.audioOn.setTextFormat(trackTextFormat);			app.trackTwo.audioOff.setTextFormat(noneTextFormat);			registerEvents();		}				private function registerEvents():void		{			app.trackOne.addEventListener(MouseEvent.CLICK,handleTrackOneClicked);			app.trackTwo.addEventListener(MouseEvent.CLICK,handleTrackTwoClicked);		}				private function handleTrackOneClicked(event:MouseEvent):void		{			trackTextFormat.color = 0xFFFFFF;			noneTextFormat.color = 0x999999;							app.trackOne.audioOn.setTextFormat(trackTextFormat);			app.trackTwo.audioOff.setTextFormat(noneTextFormat);			withSound = true;		}				private function handleTrackTwoClicked(event:MouseEvent):void		{			trackTextFormat.color = 0x999999;			noneTextFormat.color = 0xFFFFFF;						app.trackOne.audioOn.setTextFormat(trackTextFormat);			app.trackTwo.audioOff.setTextFormat(noneTextFormat);			withSound = false;		}			public function ldr_error( _e:Event ):void		{			trace( "example2.ldr_error loading: "+ _e.type );		}		private function ldr_complete( _e:Event ):void		{			trace( "example2.ldr_complete( " + _e.type +" )" );   		}				private function onThumbClick(event:TGThumbEvent):void		{			app.captionText.text = "Click the thumbnail above to set the caption here...";			view.alertText.text = "";			trace("kichcha --> numchildrennn",event.data.src);			if(app.tnList.length < 15)			{				app.tnList.addItem(event.data);				dp_sel1.addItem(event.data);				if(app.tnList.length > 0)				{					app.dragHereText.visible = false;						}			}			var captionVO:CaptionVO = new CaptionVO();			captionArr.push(captionVO);		}				private function init_ddt_sel1()		{			app.tnList.sourceField = "tn";			app.tnList.rowCount = 1;			app.tnList.rowHeight = 20;			app.tnList.columnWidth = 28;			app.tnList.direction = ScrollBarDirection.HORIZONTAL;			app.tnList.canDragFrom = true;			app.tnList.dragRemovesItem = true;			app.tnList.dropOffRemovesItem = true;			app.tnList.canDropOn = true;			app.tnList.autoScroll = true;			app.tnList.dragAlpha = .63;			app.tnList.scrollZone = .15;			app.tnList.scrollSpeed = 5;			app.tnList.allowDuplicates = true;			app.tnList.addEventListener(ListEvent.ITEM_CLICK,handleThumbnailClick);			app.tnList.addEventListener(ListEvent.ITEM_ROLL_OVER,handleThumbnailRollOver);			app.tnList.addEventListener( dd_tile_list.ITEM_DROPPED_OUTSIDE, handleDroppedItem);			//app.tnList.compareFunction = my_compare;			dp_sel1 = new DataProvider();			//app.tnList.dataProvider = dp_sel1;		}				private function handleThumbnailRollOver(event:ListEvent):void		{			tnListIndex = event.index;		}				private function handleDroppedItem(event:Event):void		{			trace("Target is :",tnListIndex);			captionArr.splice(tnListIndex,1);		}				private function handleThumbnailClick(event:ListEvent):void		{			trace("tracing the index of an thumbnail",event.index);			var caption:String;			if(CaptionVO(captionArr[event.index]).caption)			{				caption = CaptionVO(captionArr[event.index]).caption;			}			else			{				caption = "Insert Your Caption Here";			}			app.captionText.text = caption;			captionItemIndex = event.index;			app.captionText.addEventListener(Event.CHANGE,handleCaptionTextEntered);			app.captionText.addEventListener(MouseEvent.CLICK,handleCaptionTextClick);		}				private function handleCaptionTextClick(event:Event):void		{			app.captionText.text = "";		}				private function handleCaptionTextEntered(event:Event):void		{			var captionVO:CaptionVO = captionArr[captionItemIndex] as CaptionVO; 			if(app.captionText.text == "Insert Your Caption Here")			{				app.captionText.text = "";			}			captionVO.caption = app.captionText.text;			captionVO.id = captionItemIndex;		}				public function my_compare( _o:Object, _tl:dd_tile_list )		{			trace( "example2.my_compare" );			var dp:Array = _tl.dataProvider.toArray();			for( var m:int = 0; m < dp.length; m++ ) {				trace( "  comparing: "+ _o.src +" to "+ dp[m].src );				if( _o.src == dp[m].src ) {					return true;				}			}			return false;		}		private function init_ui()		{			app.previewBtn.addEventListener(MouseEvent.CLICK,handlePreviewBtnClick);			app.saveBtn.addEventListener(MouseEvent.CLICK,saveXml);		}				private function saveXml(event:Event):void		{			prevBtnClicked = false;			resultImagesArr = [];			if(app.tnList.length > 0)			{				makeYourOwnVideoVO = new MakeYourOwnVideoVO();				makeYourOwnVideoVO.member = view.member;				makeYourOwnVideoVO.id = videoId;				var caption:String;				for(var i:int = 0; i < app.tnList.length; i++)				{					if(CaptionVO(captionArr[i]).caption != null)					{						caption = CaptionVO(captionArr[i]).caption;					}					else					{						caption = "";					}					var imgNode:String = "<img caption='" + caption + "' src='"+ app.tnList.getItemAt(i).src + "' tn='" + app.tnList.getItemAt(i).tn + "' />";					resultImagesArr.push(imgNode);				}								if(withSound)				{					trace("kichcha --> save xml test with sound","<gallery><album audio='http://apptikka.com/natgeoindia/fb/missionarmy/canvas/assets/music.mp3'>"+ resultImagesArr.join("\n") +"</album></gallery>");					makeYourOwnVideoVO.videoXml = "<gallery><album audio='http://apptikka.com/natgeoindia/fb/missionarmy/canvas/assets/music.mp3'>"+ resultImagesArr.join("\n") +"</album></gallery>"; 				}				else				{					trace("kichcha --> save xml test","<gallery><album>"+ resultImagesArr.join("\n") +"</album></gallery>");					makeYourOwnVideoVO.videoXml = "<gallery><album>"+ resultImagesArr.join("\n") +"</album></gallery>";				}				Alert.show("Successfully saved your video ... Thank You !", {colour:0x212413, textColour:0xFFFFFF,background:"blur"});				var responder:Responder = new Responder(handleMakeYourOwnVideoResult, handleMakeYourOwnVideoFault);				view.rs.call("remoteMemberService.saveMakeYourOwnVideo", responder, makeYourOwnVideoVO);				var shareOwnVideoWindow:ShareOwnVideoWindow = new ShareOwnVideoWindow(view);				shareOwnVideoWindow.showWindow();			}			else			{				view.alertText.text = "Please add media to timeline before saving.";				Alert.show("There are no pictures in the timeline to make video", {colour:0x212413, textColour:0xFFFFFF, background:"blur"});			}		}				private function handleMakeYourOwnVideoResult(result:Object):void		{						makeYourOwnVideoVO = result as MakeYourOwnVideoVO;			videoId = makeYourOwnVideoVO.id;			var videoPath:String = makeYourOwnVideoVO.videoPath;			view.videoPath = videoPath;			if(prevBtnClicked)			{				app.previewSlideshow.x = 0;				app.transRect.x = 0;				app.closeBtn.x = 427.35;				app.closeBtn.addEventListener(MouseEvent.CLICK,handleCloseBtnClicked);				SlideShowPro(app.previewSlideshow).setData(videoPath,"Default");			}			else			{				view.alertText.text = "Successfully saved your video ... Thank You !";						}		}				private function handleMakeYourOwnVideoFault(fault:Object):void		{			trace("debug --> fault", fault);			view.alertText.text = "Video not saved .. Try Later";		}				private function handlePreviewBtnClick(event:MouseEvent):void		{			if(app.tnList.length > 0)			{				prevBtnClicked = true;				var myovVO:MakeYourOwnVideoVO = new MakeYourOwnVideoVO();				myovVO.member = view.member;				if(videoId)				{					myovVO.id = videoId;				}				resultImagesArr = [];				var caption:String;				for(var i:int = 0; i < app.tnList.length; i++)				{					if(CaptionVO(captionArr[i]).caption)					{						caption = CaptionVO(captionArr[i]).caption; 					}					else					{						caption = "";					}					var imgNode:String = "<img caption='" + caption + "' src='"+ app.tnList.getItemAt(i).src + "' tn='" + app.tnList.getItemAt(i).tn + "' />";					resultImagesArr.push(imgNode);				}								if(withSound)				{					trace("kichcha --> save xml test with sound","<gallery><album audio='http://apptikka.com/natgeoindia/fb/missionarmy/canvas/assets/music.mp3'>"+ resultImagesArr.join("\n") +"</album></gallery>");					myovVO.videoXml = "<gallery><album audio='http://apptikka.com/natgeoindia/fb/missionarmy/canvas/assets/music.mp3'>"+ resultImagesArr.join("\n") +"</album></gallery>"; 				}				else				{					trace("kichcha --> save xml test","<gallery><album>"+ resultImagesArr.join("\n") +"</album></gallery>");					myovVO.videoXml = "<gallery><album>"+ resultImagesArr.join("\n") +"</album></gallery>";				}								var responder:Responder = new Responder(handleMakeYourOwnVideoResult, handleMakeYourOwnVideoFault);				view.rs.call("remoteMemberService.saveMakeYourOwnVideo", responder, myovVO);			}		}				private function handleCloseBtnClicked(event:MouseEvent):void		{			SlideShowPro(app.previewSlideshow).muteMedia();			app.previewSlideshow.x = -1500;			app.transRect.x = -570;			app.closeBtn.x = -65;			app.myovInfoMc.x = -1500;		}				public function resetMedia():void		{			app.tnList.removeAll();			app.captionText.text = "";		}	}}